import {
  ILabShell,
  JupyterFrontEnd,
  JupyterFrontEndPlugin
} from '@jupyterlab/application';

import { IThemeManager } from '@jupyterlab/apputils';
import { LabIcon, jupyterFaviconIcon, jupyterIcon, jupyterlabWordmarkIcon } from '@jupyterlab/ui-components';
import { Widget } from '@lumino/widgets';
import { find } from '@lumino/algorithm';

/**
 * Initialization data for the nucleus-hub-theme extension.
 */
const plugin: JupyterFrontEndPlugin<void> = {
  id: 'nucleus-hub-theme:plugin',
  description: 'The jupyter theme for Nucleus Hub.',
  autoStart: true,
  requires: [IThemeManager, ILabShell],
  activate: (app: JupyterFrontEnd, manager: IThemeManager, shell: ILabShell) => {
    console.log('JupyterLab extension nucleus-hub-theme is activated!');
    const style = 'nucleus-hub-theme/index.css';

    const nucleus_svg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
  <g class="jp-jupyter-icon-color" fill="#006837">
    <g>
      <circle cx="32" cy="384" r="32"/>
      <circle cx="144" cy="432" r="48"/>
      <circle cx="384" cy="384" r="32"/>
      <circle cx="272" cy="432" r="48"/>
      <circle cx="32" cy="160" r="32"/>
      <circle cx="144" cy="112" r="48"/>
      <circle cx="384" cy="160" r="32"/>
      <circle cx="272" cy="112" r="48"/>
      <circle cx="416" cy="32" r="32"/>
      <circle cx="32" cy="480" r="32"/>
      <circle cx="40" cy="72" r="24"/>
    </g>
  </g>
</svg>`;

    const nucleus_wordmark_svg = `<svg data-name="Layer 2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1192.18 181.29">
  <g data-name="Layer 2">
    <g>
      <path class="jp-icon0" fill="#000000" d="M0,179.34V52.46h19.03v23.18c1.3-3.58,2.97-6.99,5-10.25,2.03-3.25,4.55-6.02,7.56-8.3,3.01-2.28,6.38-3.94,10.13-5,3.74-1.06,7.48-1.59,11.22-1.59,4.06,0,8.01.57,11.83,1.71,3.82,1.14,7.28,3.01,10.37,5.61,3.09,2.6,5.65,5.61,7.69,9.03,2.03,3.42,3.66,7.04,4.88,10.86,1.22,3.82,2.03,7.73,2.44,11.71.4,3.99.61,7.93.61,11.83v78.08h-19.03v-78.08c0-2.76-.16-5.49-.49-8.17-.33-2.68-.9-5.28-1.71-7.81-.82-2.52-1.99-4.92-3.54-7.2-1.55-2.28-3.38-4.23-5.49-5.86-2.12-1.62-4.48-2.81-7.08-3.54-2.6-.73-5.29-1.1-8.05-1.1s-5.45.37-8.05,1.1c-2.6.73-4.96,1.91-7.08,3.54-2.12,1.63-3.95,3.58-5.49,5.86-1.55,2.28-2.73,4.68-3.54,7.2-.82,2.52-1.38,5.12-1.71,7.81-.33,2.68-.49,5.41-.49,8.17v78.08H0Z"/>
      <path class="jp-icon0" fill="#000000" d="M159.82,181.29c-4.07,0-8.01-.57-11.83-1.71-3.82-1.14-7.28-3.01-10.37-5.61-3.09-2.6-5.65-5.61-7.69-9.03-2.04-3.42-3.66-7.03-4.88-10.86-1.22-3.82-2.04-7.72-2.44-11.71-.41-3.98-.61-7.93-.61-11.83V52.46h19.03v78.08c0,2.77.16,5.49.49,8.17.32,2.68.89,5.29,1.71,7.81.81,2.52,1.99,4.92,3.54,7.2,1.54,2.28,3.37,4.23,5.49,5.86,2.11,1.63,4.47,2.81,7.08,3.54,2.6.73,5.28,1.1,8.05,1.1s5.45-.37,8.05-1.1c2.6-.73,4.96-1.91,7.08-3.54,2.11-1.62,3.94-3.58,5.49-5.86,1.54-2.28,2.72-4.67,3.54-7.2.81-2.52,1.38-5.12,1.71-7.81.32-2.68.49-5.41.49-8.17V52.46h19.03v126.88h-19.03v-23.18c-1.3,3.58-2.97,7-5,10.25-2.04,3.26-4.56,6.02-7.56,8.3-3.01,2.28-6.39,3.95-10.13,5-3.74,1.06-7.48,1.59-11.22,1.59Z"/>
      <path class="jp-icon0" fill="#000000" d="M288.65,181.29c-4.39,0-8.75-.45-13.05-1.34-4.31-.89-8.34-2.44-12.08-4.64-3.74-2.2-7.04-4.96-9.88-8.3-2.85-3.33-5.17-6.99-6.95-10.98-1.79-3.98-3.01-8.13-3.66-12.44-.65-4.31-.98-8.66-.98-13.05v-29.28c0-4.39.32-8.74.98-13.05.65-4.31,1.87-8.46,3.66-12.44,1.79-3.98,4.11-7.64,6.95-10.98,2.84-3.33,6.14-6.1,9.88-8.3,3.74-2.2,7.77-3.74,12.08-4.64,4.31-.89,8.66-1.34,13.05-1.34,4.06,0,8.13.33,12.2.98,4.06.65,7.89,1.87,11.47,3.66,3.58,1.79,6.87,4.11,9.88,6.95,3.01,2.85,5.49,6.06,7.44,9.64,1.95,3.58,3.37,7.36,4.27,11.35.89,3.99,1.34,8.01,1.34,12.08v1.22h-19.03v-.73c0-3.74-.57-7.4-1.71-10.98-1.14-3.58-3.01-6.71-5.61-9.39-2.6-2.68-5.7-4.64-9.27-5.86-3.58-1.22-7.24-1.83-10.98-1.83-2.77,0-5.49.33-8.17.98-2.68.65-5.17,1.79-7.44,3.42-2.28,1.63-4.19,3.58-5.73,5.86-1.55,2.28-2.81,4.68-3.78,7.2-.98,2.52-1.63,5.17-1.95,7.93-.33,2.77-.49,5.53-.49,8.3v29.28c0,2.77.16,5.53.49,8.3.32,2.77.98,5.41,1.95,7.93.98,2.52,2.23,4.92,3.78,7.2,1.54,2.28,3.45,4.23,5.73,5.86,2.28,1.63,4.76,2.77,7.44,3.42,2.68.65,5.41.98,8.17.98,3.74,0,7.4-.61,10.98-1.83,3.58-1.22,6.67-3.17,9.27-5.86,2.6-2.68,4.47-5.81,5.61-9.39,1.14-3.58,1.71-7.24,1.71-10.98v-.73h19.03v1.22c0,4.07-.45,8.09-1.34,12.08-.9,3.99-2.32,7.77-4.27,11.35-1.95,3.58-4.43,6.79-7.44,9.64-3.01,2.85-6.31,5.17-9.88,6.95-3.58,1.79-7.4,3.01-11.47,3.66-4.07.65-8.14.98-12.2.98Z"/>
      <path class="jp-icon0" fill="#000000" d="M368.68,179.34v-17.08h34.89V17.08h-31.48V0h50.51v162.26h31.48v17.08h-85.4Z"/>
      <path class="jp-icon0" fill="#000000" d="M533.38,181.29c-4.39,0-8.75-.45-13.05-1.34-4.31-.89-8.38-2.4-12.2-4.51-3.82-2.11-7.24-4.84-10.25-8.17-3.01-3.33-5.41-6.99-7.2-10.98-1.79-3.98-3.01-8.17-3.66-12.57-.65-4.39-.98-8.78-.98-13.18v-29.28c0-4.39.32-8.78.98-13.18.65-4.39,1.87-8.58,3.66-12.57,1.79-3.98,4.19-7.64,7.2-10.98,3.01-3.33,6.42-6.06,10.25-8.17,3.82-2.11,7.89-3.62,12.2-4.51,4.31-.89,8.66-1.34,13.05-1.34s8.74.45,13.05,1.34c4.31.9,8.38,2.4,12.2,4.51,3.82,2.12,7.24,4.84,10.25,8.17,3.01,3.34,5.41,7,7.2,10.98,1.79,3.99,3.01,8.17,3.66,12.57.65,4.39.98,8.78.98,13.18v23.18h-75.64v6.1c0,2.77.16,5.53.49,8.3.32,2.77.98,5.45,1.95,8.05.98,2.6,2.32,5.04,4.03,7.32,1.71,2.28,3.7,4.19,5.98,5.73,2.28,1.55,4.8,2.65,7.56,3.29,2.76.65,5.53.98,8.3.98,3.25,0,6.47-.28,9.64-.85,3.17-.57,6.14-1.71,8.91-3.42,2.76-1.71,5-3.98,6.71-6.83,1.71-2.84,2.56-5.89,2.56-9.15h19.03c0,3.74-.61,7.4-1.83,10.98-1.22,3.58-2.93,6.87-5.12,9.88-2.2,3.01-4.84,5.61-7.93,7.81-3.09,2.2-6.39,3.95-9.88,5.25-3.5,1.3-7.12,2.2-10.86,2.68-3.74.49-7.48.73-11.22.73ZM561.69,107.36v-6.1c0-2.76-.16-5.53-.49-8.3-.33-2.76-.98-5.45-1.95-8.05-.98-2.6-2.32-5.04-4.03-7.32-1.71-2.28-3.7-4.19-5.98-5.73-2.28-1.54-4.8-2.64-7.56-3.29-2.77-.65-5.53-.98-8.3-.98s-5.53.33-8.3.98c-2.77.65-5.29,1.75-7.56,3.29-2.28,1.55-4.27,3.46-5.98,5.73-1.71,2.28-3.05,4.72-4.03,7.32-.98,2.6-1.63,5.29-1.95,8.05-.33,2.77-.49,5.53-.49,8.3v6.1h56.61Z"/>
      <path class="jp-icon0" fill="#000000" d="M647.82,181.29c-4.07,0-8.01-.57-11.83-1.71-3.82-1.14-7.28-3.01-10.37-5.61-3.09-2.6-5.65-5.61-7.69-9.03-2.04-3.42-3.66-7.03-4.88-10.86-1.22-3.82-2.04-7.72-2.44-11.71-.41-3.98-.61-7.93-.61-11.83V52.46h19.03v78.08c0,2.77.16,5.49.49,8.17.32,2.68.89,5.29,1.71,7.81.81,2.52,1.99,4.92,3.54,7.2,1.54,2.28,3.37,4.23,5.49,5.86,2.11,1.63,4.47,2.81,7.08,3.54,2.6.73,5.28,1.1,8.05,1.1s5.45-.37,8.05-1.1c2.6-.73,4.96-1.91,7.08-3.54,2.11-1.62,3.94-3.58,5.49-5.86,1.54-2.28,2.72-4.67,3.54-7.2.81-2.52,1.38-5.12,1.71-7.81.32-2.68.49-5.41.49-8.17V52.46h19.03v126.88h-19.03v-23.18c-1.3,3.58-2.97,7-5,10.25-2.04,3.26-4.56,6.02-7.56,8.3-3.01,2.28-6.39,3.95-10.13,5-3.74,1.06-7.48,1.59-11.22,1.59Z"/>
      <path class="jp-icon0" fill="#000000" d="M777.14,181.29c-3.58,0-7.12-.21-10.61-.61-3.5-.41-6.95-1.14-10.37-2.2-3.42-1.06-6.63-2.52-9.64-4.39-3.01-1.87-5.65-4.15-7.93-6.83-2.28-2.68-4.03-5.73-5.25-9.15s-1.83-6.91-1.83-10.49v-1.22h19.03v.73c0,2.93.89,5.61,2.68,8.05,1.79,2.44,4.03,4.35,6.71,5.73,2.68,1.38,5.49,2.28,8.42,2.68,2.93.41,5.86.61,8.78.61s5.89-.24,8.91-.73c3.01-.49,5.81-1.38,8.42-2.68,2.6-1.3,4.84-3.21,6.71-5.73,1.87-2.52,2.81-5.25,2.81-8.17s-.82-5.57-2.44-7.93c-1.63-2.36-3.62-4.31-5.98-5.86-2.36-1.54-4.84-2.81-7.44-3.78-2.6-.98-5.25-1.87-7.93-2.68-2.68-.81-5.37-1.67-8.05-2.56-2.68-.89-5.33-1.87-7.93-2.93-2.6-1.06-5.12-2.23-7.56-3.54-2.44-1.3-4.8-2.81-7.08-4.51-2.28-1.71-4.35-3.58-6.22-5.61-1.87-2.03-3.54-4.23-5-6.59-1.46-2.36-2.56-4.92-3.29-7.69-.73-2.76-1.1-5.53-1.1-8.3,0-3.42.53-6.83,1.59-10.25,1.06-3.42,2.64-6.5,4.76-9.27,2.11-2.76,4.64-5.12,7.56-7.08,2.93-1.95,6.02-3.54,9.27-4.76,3.25-1.22,6.63-2.03,10.13-2.44,3.5-.4,6.95-.61,10.37-.61s6.83.21,10.25.61c3.42.41,6.75,1.18,10,2.32,3.25,1.14,6.34,2.65,9.27,4.51,2.93,1.87,5.45,4.15,7.56,6.83,2.11,2.68,3.74,5.7,4.88,9.03,1.14,3.34,1.71,6.71,1.71,10.13v1.46h-19.03v-.73c0-2.76-.77-5.37-2.32-7.81-1.55-2.44-3.54-4.35-5.98-5.73-2.44-1.38-5.09-2.32-7.93-2.81-2.85-.49-5.65-.73-8.42-.73s-5.57.24-8.42.73c-2.85.49-5.49,1.43-7.93,2.81-2.44,1.38-4.48,3.34-6.1,5.86-1.63,2.52-2.44,5.17-2.44,7.93s.81,5.37,2.44,7.81c1.62,2.44,3.58,4.43,5.86,5.98,2.28,1.55,4.76,2.81,7.44,3.78,2.68.98,5.37,1.87,8.05,2.68,2.68.82,5.33,1.67,7.93,2.56,2.6.9,5.2,1.87,7.81,2.93,2.6,1.06,5.16,2.24,7.69,3.54,2.52,1.3,4.88,2.81,7.08,4.51,2.2,1.71,4.27,3.58,6.22,5.61,1.95,2.04,3.66,4.23,5.12,6.59,1.46,2.36,2.56,4.92,3.29,7.69.73,2.77,1.1,5.53,1.1,8.3,0,3.58-.61,7.08-1.83,10.49-1.22,3.42-2.93,6.51-5.12,9.27-2.2,2.77-4.84,5.12-7.93,7.08-3.09,1.95-6.31,3.5-9.64,4.64-3.34,1.14-6.79,1.91-10.37,2.32-3.58.4-7.16.61-10.74.61Z"/>
      <path class="jp-jupyter-icon-color" fill="#006837" d="M852.54,179.34V0h30.26v73.93c1.14-3.25,2.6-6.34,4.39-9.27,1.79-2.93,3.98-5.49,6.59-7.69,2.6-2.2,5.53-3.82,8.78-4.88,3.25-1.06,6.59-1.59,10-1.59,3.74,0,7.44.69,11.1,2.07,3.66,1.38,6.83,3.42,9.52,6.1,2.68,2.68,4.88,5.78,6.59,9.27,1.71,3.5,3.05,7.08,4.03,10.74.98,3.66,1.62,7.4,1.95,11.22.32,3.82.49,7.61.49,11.35v78.08h-30.26v-78.08c0-1.95-.08-3.86-.24-5.73-.16-1.87-.49-3.7-.98-5.49-.49-1.79-1.14-3.54-1.95-5.25-.82-1.71-1.87-3.25-3.17-4.64-1.3-1.38-2.85-2.4-4.64-3.05-1.79-.65-3.66-.98-5.61-.98s-3.82.33-5.61.98c-1.79.65-3.34,1.67-4.64,3.05-1.3,1.38-2.36,2.93-3.17,4.64-.82,1.71-1.46,3.46-1.95,5.25-.49,1.79-.82,3.62-.98,5.49-.16,1.87-.24,3.78-.24,5.73v78.08h-30.26Z"/>
      <path class="jp-jupyter-icon-color" fill="#006837" d="M1008.21,181.29c-3.74,0-7.44-.69-11.1-2.07s-6.83-3.42-9.52-6.1c-2.68-2.68-4.88-5.77-6.59-9.27-1.71-3.5-3.05-7.08-4.03-10.74-.98-3.66-1.63-7.4-1.95-11.22-.33-3.82-.49-7.6-.49-11.35V52.46h30.26v78.08c0,1.95.08,3.87.24,5.73.16,1.87.49,3.7.98,5.49.49,1.79,1.14,3.54,1.95,5.25.81,1.71,1.87,3.26,3.17,4.64,1.3,1.38,2.84,2.4,4.64,3.05,1.79.65,3.66.98,5.61.98s3.82-.32,5.61-.98c1.79-.65,3.33-1.67,4.64-3.05,1.3-1.38,2.36-2.93,3.17-4.64.81-1.71,1.46-3.45,1.95-5.25.49-1.79.81-3.62.98-5.49.16-1.87.24-3.78.24-5.73V52.46h30.26v126.88h-30.26v-21.47c-1.14,3.26-2.6,6.34-4.39,9.27-1.79,2.93-3.99,5.49-6.59,7.69-2.6,2.2-5.53,3.82-8.78,4.88-3.26,1.06-6.59,1.59-10,1.59Z"/>
      <path class="jp-jupyter-icon-color" fill="#006837" d="M1157.54,181.29c-3.42,0-6.83-.53-10.25-1.59-3.42-1.06-6.47-2.68-9.15-4.88-2.68-2.2-4.96-4.8-6.83-7.81-1.87-3.01-3.38-6.14-4.51-9.39v21.72h-30.26V0h30.26v74.18c1.14-3.25,2.64-6.38,4.51-9.39,1.87-3.01,4.15-5.61,6.83-7.81,2.68-2.2,5.73-3.82,9.15-4.88,3.42-1.06,6.83-1.59,10.25-1.59,3.9,0,7.69.65,11.35,1.95,3.66,1.3,6.87,3.29,9.64,5.98,2.76,2.68,5.04,5.78,6.83,9.27,1.79,3.5,3.21,7.08,4.27,10.74,1.06,3.66,1.75,7.4,2.07,11.22.32,3.82.49,7.69.49,11.59v29.28c0,3.9-.16,7.77-.49,11.59-.33,3.82-1.02,7.56-2.07,11.22-1.06,3.66-2.48,7.24-4.27,10.74-1.79,3.5-4.07,6.59-6.83,9.27-2.77,2.68-5.98,4.68-9.64,5.98s-7.44,1.95-11.35,1.95ZM1144.36,155.67c2.93,0,5.65-.77,8.17-2.32,2.52-1.54,4.47-3.58,5.86-6.1,1.38-2.52,2.32-5.2,2.81-8.05.49-2.84.73-5.73.73-8.66v-29.28c0-2.93-.24-5.81-.73-8.66-.49-2.84-1.43-5.53-2.81-8.05-1.38-2.52-3.34-4.55-5.86-6.1-2.52-1.54-5.25-2.32-8.17-2.32s-5.65.77-8.17,2.32c-2.52,1.55-4.48,3.58-5.86,6.1-1.38,2.52-2.32,5.21-2.81,8.05-.49,2.85-.73,5.73-.73,8.66v29.28c0,2.93.24,5.82.73,8.66.49,2.85,1.42,5.53,2.81,8.05,1.38,2.52,3.33,4.56,5.86,6.1,2.52,1.55,5.25,2.32,8.17,2.32Z"/>
    </g>
  </g>
</svg>`;

    // const logo = find(shell.widgets("top"), widget => widget.id === "jp-MainLogo") || new Widget();
    const nucleusIcon = new LabIcon({ name: 'ui-components:nucleus-logo', svgstr: nucleus_svg });

    const logo = new Widget();
    nucleusIcon.element({
      container: logo.node,
      elementPosition: 'center',
      margin: '2px 2px 2px 8px',
      height: 'auto',
      width: '16px'
    });
    shell.add(wordmark, 'top', { rank: 1500 });

    const nucleusWordMark = new LabIcon({ name: "ui-components:nucleus-wordmark", svgstr: nucleus_wordmark_svg });
    const wordmark = new Widget();
    nucleusWordMark.element({
      container: wordmark.node,
      elementPosition: 'right',

      margin: '0 0 0 auto',
      height: '70%',
      width: '70%',
    });
    wordmark.id = "jp-nucleusWordmark"
    shell.add(wordmark, 'top', { rank: 1500 });

    console.log("Setting logo svg");
    jupyterFaviconIcon.svgstr = nucleus_svg;
    jupyterIcon.svgstr = nucleus_svg;
    jupyterlabWordmarkIcon.svgstr = nucleus_wordmark_svg;
    console.log(nucleus_svg.length, jupyterIcon.svgstr.length);

    manager.register({
      name: 'nucleus-hub-theme',
      isLight: true,
      load: () => manager.loadCSS(style),
      unload: () => Promise.resolve(undefined)
    });
  },
};

export default plugin;
